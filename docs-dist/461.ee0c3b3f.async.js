"use strict";(self.webpackChunkrsc_component=self.webpackChunkrsc_component||[]).push([[461],{25461:function(ce,U,l){l.r(U),l.d(U,{RoleTable:function(){return ne}});var H=l(5574),Z=l.n(H),b=l(19632),n=l.n(b),z=l(32808),Q=l(11579),V=l(91966),R=l.n(V),A=l(67294),W=l(97857),G=l.n(W),X=function y(a){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;return a.reduce(function(u,r){var e=r.key,v=r.title,f=r.uiPermissions,o=r.children,t=G()({},u);if(t[e]=G()({key:e,title:v,uiPermissions:f,parent:i},o&&{children:o}),o){var s=y(o,e);t=G()(G()({},t),s)}return t},{})},Y=function y(a){return a.reduce(function(i,u){var r=i.menu,e=i.checkedPermissions,v=u.uiPermissions,f=u.key,o=u.children;if(r=[].concat(n()(r),[f]),e=[].concat(n()(e),n()(v.map(function(g){return g.key}))),o){var t=y(o),s=t.menu,m=t.checkedPermissions;r=[].concat(n()(r),n()(s)),e=[].concat(n()(e),n()(m))}return{menu:r,checkedPermissions:e}},{menu:[],checkedPermissions:[]})},$=l(85893),q=function(a,i,u){var r=a.children,e=a.uiPermissions.map(function(t){return t.key}),v=!e.some(function(t){return i.includes(t)});if(r){var f=r.map(function(t){return t.key}),o=!f.some(function(t){return u.includes(t)});return v&&o}return v},_=function y(a){return a.reduce(function(i,u){var r=i.menus,e=i.uiCollection,v=u.uiPermissions,f=u.key,o=u.children;if(r=[].concat(n()(r),[f]),e=[].concat(n()(e),n()(v.map(function(g){return g.key}))),o){var t=y(o),s=t.menus,m=t.uiCollection;r=[].concat(n()(r),n()(s)),e=[].concat(n()(e),n()(m))}return{menus:r,uiCollection:e}},{menus:[],uiCollection:[]})},w=function(a,i){for(var u=a.key,r=a.children,e=i[u],v=e.uiPermissions.map(function(M){return M.key}),f=[],o=[u],t=n()(v),s=e.parent;s;)f.push(s),s=i[s].parent;if(r){var m=_(r),g=m.menus,I=m.uiCollection;o=[].concat(n()(o),n()(g)),t=[].concat(n()(t),n()(I))}return{ancestorMenus:f,laterGenerMenus:o,uiPermissions:t}},ee=function(a){var i=a.data,u=a.value,r=u===void 0?{menu:[],checkedPermissions:[]}:u,e=a.onChange,v=a.className,f=v===void 0?"":v,o=(0,A.useState)(r.menu),t=Z()(o,2),s=t[0],m=t[1],g=(0,A.useState)(r.checkedPermissions),I=Z()(g,2),M=I[0],T=I[1],p=(0,A.useMemo)(function(){return X(i)},[i]),F=(0,A.useMemo)(function(){return Y(i)},[i]),re=(0,A.useCallback)(function(S){return!!M.find(function(d){return d===S})},[M]),te=function(d,C,h){var k=n()(M),c=n()(s),P=h.key,x=p[P],j=w(x,p),D=j.ancestorMenus;if(d.target.checked)k.push(C),c=n()(new Set([].concat(n()(c),n()(D),[P])));else if(k.splice(k.indexOf(C),1),q(h,k,c)){c.splice(c.indexOf(P),1);var L=D.filter(function(N){var O=p[N],B=O.children.map(function(E){return E.key})||[],K=R()(B,[P]);return!K.some(function(E){return s.includes(E)})});c=R()(c,L)}T(k),m(c),e==null||e({menu:c,checkedPermissions:k})},se={selectedRowKeys:s,onChange:function(d){m(d)},onSelect:function(d,C){var h=d.key,k=p[h];console.log("treeChecked",s);var c=w(k,p),P=c.ancestorMenus,x=c.laterGenerMenus,j=c.uiPermissions;if(console.log("ancestorMenus",P),console.log("laterGenerMenus",x),console.log("uiPermissions",j),C){var D=n()(new Set([].concat(n()(M),n()(j)))),L=n()(new Set([].concat(n()(P),n()(x),n()(s))));setTimeout(function(){m(L),T(D),e==null||e({menu:L,checkedUipermissons:D})},0)}else{var N=R()(M,j);console.log("treeChecked-cancll",s);var O=P.filter(function(E){var oe=p[E],ue=oe.children.map(function(J){return J.key})||[],ae=R()(ue,[h]);return!ae.some(function(J){return s.includes(J)})}),B=[].concat(n()(x),n()(O));console.log("canceledMenus",B);var K=R()(s,B);console.log("realCheckedMenus",K),setTimeout(function(){T(N),m(K),e==null||e({menu:K,checkedPermissions:N})},0)}},onSelectAll:function(d){if(d){var C=F.menu,h=F.checkedPermissions;T(h),m(C),e==null||e(F)}else T([]),m([]),e==null||e({menu:[],checkedPermissions:[]})}},ie=[{title:"\u83DC\u5355",dataIndex:"title",key:"key",width:"30%"},{title:"\u6743\u9650",dataIndex:"uiPermissions",key:"uiPermissions",width:"70%",render:function(d,C){return d!=null&&d.length?d.map(function(h){return(0,$.jsx)(z.Z,{checked:re(h.key),onChange:function(c){return te(c,h.key,C)},children:h.title},h.key)}):null}}];return(0,$.jsx)(Q.Z,{rowKey:"key",rowClassName:f,columns:ie,rowSelection:se,dataSource:i,pagination:!1,defaultExpandAllRows:!0})},ne=ee}}]);
